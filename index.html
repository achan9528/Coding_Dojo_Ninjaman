<html>
    <head>
        <title>NinjaMan</title>
        <style type="text/css">
            * {
                margin: 0;
                padding: 0;
            }
            .row{
                line-height: 0;
            }
            .wall{
                background-color: lightblue;
                height: 40px;
                width: 40px;
                display: inline-block;
            }
            .sushi{
                background-color: white;
                background-image: url('./img/sushi.png');
                background-repeat: no-repeat;
                background-position: center;
                height: 40px;
                width: 40px;
                display: inline-block;
            }
            .onigiri{
                background-color: white;
                background-image: url('./img/onigiri.png');
                background-repeat: no-repeat;
                background-position: center;
                height: 40px;
                width: 40px;
                display: inline-block;
            }
            .ghost{
                background-color: white;
                background-image: url('./img/pinky.gif');
                background-repeat: no-repeat;
                background-position: center;
                height: 40px;
                width: 40px;
                display: inline-block;
            }
            .blank{
                background-color: white;
                height: 40px;
                width: 40px;
                display: inline-block;
            }
            .ninja{
                background-color: white;
                background-image:url('./img/ninja.gif');
                height: 40px;
                width: 40px;
                display: inline-block;
                background-size: contain;
                border-color: red;
                border-style: dotted;
            }
            #ninja{
                background-color: white;
                background-image:url('./img/ninja.gif');
                height: 40px;
                width: 40px;
                display: inline-block;
                background-size: contain;
                position: absolute;
            }
            #scoreboard{
                background-color:cadetblue;
                height: 80px;
                width: 440px;
                /* display:inline-block; */
            }
            .scoreinfo{
                width: 50%;
                height: 100%;
                display: inline-block;
                vertical-align:top;
            }
            .life{
                background-image:url('./img/right1.png');
                background-repeat: no-repeat;
                background-position: center;
                height: 100%;
                width: 30%;
                display:inline-block;
                /* vertical-align: top; */
            }
            .score_image{
                width: 48%;
                height: 100%;
                background-image:url('./img/sushi.png');
                background-repeat: no-repeat;
                background-position: center;
                display: inline-block;
                /* vertical-align: top; */
            }
            .score_number{
                width: 48%;
                display: inline-block;
                vertical-align: top;
                text-align: center;
                padding-top: 11%;
                padding-bottom: 11%;
                font:bold;
                font-family: sans-serif;
                font-size:x-large;
                border-color:red;
                border-style:dotted;
            }
            #gameOver{
                display: inline-block;
                font:bold;
                font-family: sans-serif;
                font-size:x-large;
                border-color:red;
                border-style:dotted;
                padding: 100px 0;
                vertical-align: top;
                visibility: hidden;
            }
            #world{
                display: inline-block;
            }
        </style>

    </head>
    <body>

        <div id='scoreboard'>
            <div id='lives' class = 'scoreinfo' >
                <!-- <div class='life'></div>
                <div class='life'></div>
                <div class='life'></div> -->
            </div><div class = 'scoreinfo'>
                <div id ='sushi_counter' class='score_number'>
                    <p>0</p>
                </div>
                <div class='score_image'></div>
            </div>
        </div>
        <div id='gameScreen'>
            <div id='world' class='world'></div>
            <div id = 'ninja' class='ninja'></div>
            <div id = 'gameOver'>
                <h1>Game Over!</h1>
            </div>
        </div>
        <script type='text/javascript'>
            var world = []
            function randomWorld(){
                var i = 0;
                var n = 0;
                // This code makes a randomly dimensioned world with a minimum size. 
                // do {
                //     i = Math.floor(Math.random() * 50);    
                // } while (i < 10 || i > 40);
                
                // do {
                //     n = Math.floor(Math.random() * 50);
                // } while (n < 10 || n > 40);

                // as long as one block connects from the last row then that is sufficient to 
                // create a playable board.
                var w = [];
                var v = [];
                var temp = 0;
                for (var a = 0; a < 11; a++){
                    for (var b = 0; b < 11; b++){
                        do {
                            temp = (Math.floor(Math.random() * 10));
                        } while (temp > 4)
                        v.push(temp);
                    }
                    w.push(v);
                    v = [];
                }
                console.log(i);
                console.log(n);
                return w;
            }
            var world = randomWorld();
            // var world = [
            //     [1,1,1,1,1,1,1,1,1,1,1],
            //     [1,1,1,1,1,1,1,1,1,1,1],
            //     [1,1,1,1,1,1,1,1,1,1,1],
            //     [1,1,1,1,1,1,1,1,1,1,1],
            //     [1,1,1,1,0,0,2,1,1,1,1],
            //     [1,1,1,1,0,3,0,1,1,1,1],
            //     [1,1,1,1,4,0,0,1,1,1,1],
            //     [1,1,1,1,1,1,1,1,1,1,1],
            //     [1,1,1,1,1,1,1,1,1,1,1],
            //     [1,1,1,1,1,1,1,1,1,1,1],
            //     [1,1,1,1,1,1,1,1,1,1,1],
            // ];
            
            var worldDict = {
                0: 'blank',
                1: 'wall',
                2: 'sushi',
                3: 'onigiri',
                4: 'ghost'
            };

            var ninja = {
                x: 0, // these are multipliers to the pixels
                y: 0,
                sushi: 0,
                lives: 3
            };

            function drawWorld(){
                var row_output = "<div class = 'row'>";
                var col_output = "";
                var output = "";
                for (var i = 0; i < world.length ;i++){
                    for (var n = 0; n < world[i].length; n++){
                        if (worldDict[world[i][n]] == 'ninja'){
                            row_output += "<div class = 'ninja' id = 'ninja'></div>";
                        } else{
                        row_output += "<div class = '" + worldDict[world[i][n]] + "'></div>";
                        }
                    }
                    output += row_output + "</div>";
                    row_output = "<div class = 'row'>";
                }
                document.getElementById('world').innerHTML = output;
            };

            function drawScoreboard(){
                // draws lives section
                var output = ""
                for (var i = 0; i < ninja.lives; i++){
                    output += "<div class = 'life'></div>";
                }
                document.getElementById('lives').innerHTML = output + "</div>";

                // draw count
                document.getElementById('sushi_counter').innerHTML = "<p>" + ninja.sushi + "</p>";;
                
            };

            function initNinja(){
                var foundStart = false;
                for (var i = 0; i < world.length; i++){
                    for (var n = 0; n < world[i].length; n++){
                        if (world[i][n] == 0){
                            ninja.x = n
                            foundStart = true;
                            break;
                        }
                    }
                    if (foundStart){
                        break;
                    } else {
                        ninja.y += 1;
                    }
                }
                document.getElementById('ninja').style.left = (ninja.x * 40) + "px"
                document.getElementById('ninja').style.top = ((ninja.y * 40) + 80) + "px"
                // console.log(ninja.x);
                // console.log(ninja.y);
            }

            function drawNinja(){
                document.getElementById('ninja').style.left = (ninja.x * 40) + "px"
                document.getElementById('ninja').style.top = ((ninja.y * 40) + 80) + "px"
            };

            function drawGameOver(){
                document.getElementById('gameOver').style.visibility = 'visible';
                document.onkeydown = function(e){};
            }



            document.onkeydown = function(e){    
                // make the ninja walk
                moveDict = {
                    37: 'left',
                    38: 'up',
                    39: 'right',
                    40: 'down'
                };
                var dir = moveDict[e.keyCode];
                
                var next_space = 1;

                if (dir == 'left'){
                    document.getElementById('ninja').style.webkitTransform = "scaleX(-1)";
                    if (ninja.x - 1 >= 0){
                        next_space = world[ninja.y][ninja.x - 1];
                        if (next_space != 1){
                            ninja.x--;
                            if (next_space >= 2){
                                world[ninja.y][ninja.x] = 0;
                                if (next_space == 2 || next_space == 3){
                                    ninja.sushi++;
                                } else if (next_space == 4){
                                    ninja.lives--;
                                };
                            };
                        };
                    };
                } else if (dir == 'right'){
                    document.getElementById('ninja').style.webkitTransform = "scaleX(1)";
                    if (ninja.x + 1 < world[0].length){
                        next_space = world[ninja.y][ninja.x + 1];
                        if (next_space != 1){
                            ninja.x++;
                            if (next_space >= 2){
                                world[ninja.y][ninja.x] = 0;
                                if (next_space == 2 || next_space == 3){
                                    ninja.sushi++;
                                } else if (next_space == 4){
                                    ninja.lives--;
                                };
                            };
                        };
                    };
                } else if (dir == 'up'){
                    document.getElementById('ninja').style.transform = "rotate(270deg)";
                    if (ninja.y - 1 >= 0){
                        next_space = world[ninja.y - 1][ninja.x];
                        if (next_space != 1){
                            ninja.y--;
                            if (next_space >= 2){
                                world[ninja.y][ninja.x] = 0;
                                if (next_space == 2 || next_space == 3){
                                    ninja.sushi++;
                                } else if (next_space == 4){
                                    ninja.lives--;
                                };
                            };
                        };
                    };
                } else if (dir == 'down'){
                    document.getElementById('ninja').style.transform = "rotate(90deg)";
                    if (ninja.y + 1 <= world.length){
                        next_space = world[ninja.y + 1][ninja.x];
                        if (next_space != 1){
                            ninja.y++;
                            if (next_space >= 2){
                                world[ninja.y][ninja.x] = 0;
                                if (next_space == 2 || next_space ==3){
                                    ninja.sushi++;
                                } else if (next_space == 4){
                                    ninja.lives--;
                                }
                            }
                        }
                    };
                };

                drawScoreboard();
                drawWorld();
                drawNinja();
                console.log(ninja.lives);

                if (ninja.lives == 0){
                    drawGameOver();
                }
            };
                
            drawWorld();
            drawScoreboard();
            initNinja();
            randomWorld();
        </script>
    </body>
</html>